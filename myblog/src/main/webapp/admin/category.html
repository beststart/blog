<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <title>分类管理</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
    <meta content="Coderthemes" name="author"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <link rel="shortcut icon" href="../static/image/logo.png"/>
    <link href="../vendor/bootstrap/css/bootstrap.css" rel="stylesheet" type="text/css"/>
    <link href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet"/>
    <link href="../vendor/css/style.css" rel="stylesheet" type="text/css"/>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/limonte-sweetalert2/6.4.1/sweetalert2.min.css" rel="stylesheet"/>
    <link href="../vendor/tagsinput/jquery.tagsinput.css" rel="stylesheet"/>
    <link href="../vendor/select2.dist.css/select2-bootstrap.css" rel="stylesheet"/>
    <link href="../vendor/toggles/toggles.css" rel="stylesheet"/>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/multi-select/0.9.12/css/multi-select.min.css" rel="stylesheet"/>
    <link href="https://cdn.bootcss.com/select2/3.4.8/select2.min.css" rel="stylesheet">
    <style>
        .table tbody tr td {
            vertical-align: middle;
        }
    </style>
</head>

<body class="fixed-left">
<div id="wrapper">
    <div>
        <div class="topbar">
            <div class="topbar-left">
                <div class="text-center p-t-10" style="margin: 0 auto;">
                    <div class="pull-left" style="padding-left: 10px;">
                        <a href="/admin/index.html">
                            <img src="../static/image/logo.png" width="50" height="50"/>
                        </a>
                    </div>
                    <div class="pull-left" style="padding-left: 10px;">
                        <span style="font-size: 20px; color: #2f353f; line-height: 50px;">我的博客</span>
                    </div>
                </div>
            </div>
            <div class="navbar navbar-default" role="navigation">
                <div class="container">
                    <div class="">
                        <div class="pull-left">
                            <button type="button" class="button-menu-mobile open-left">
                                <i class="fa fa-bars"></i>
                            </button>
                            <span class="clearfix"></span>
                        </div>

                        <ul class="nav navbar-nav navbar-right pull-right">
                            <li class="dropdown">
                                <a href="/admin/index.html" class="dropdown-toggle profile" data-toggle="dropdown"
                                   aria-expanded="true">
                                    <span class="glyphicon glyphicon-user"/>
                                </a>
                                <ul class="dropdown-menu">
                                    <li><a href="javascript:void(0);" onclick="logout()"><i class="fa fa-sign-out"></i>
                                        注销</a></li>
                                </ul>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <div class="left side-menu">
            <div class="sidebar-inner slimscrollleft">
                <div id="sidebar-menu">
                    <ul>
                        <li>
                            <a id="index" href="index.html" class="waves-effect">
                                <i class="fa fa-dashboard" aria-hidden="true"></i>
                                <span> 仪表盘 </span>
                            </a>
                        </li>
                        <li>
                            <a id="article_edit" href="article_edit.html?type=newArticle" class="waves-effect">
                                <i class="fa fa-pencil-square-o" aria-hidden="true"></i>
                                <span> 发布文章 </span>
                            </a>
                        </li>
                        <li>
                            <a href="article_list.html" class="waves-effect">
                                <i class="fa fa-list" aria-hidden="true"></i>
                                <span> 文章管理 </span>
                            </a>
                        </li>
                        <li>
                            <a href="comment_list.html" class="waves-effect">
                                <i class="fa fa-comments" aria-hidden="true"></i>
                                <span> 评论管理 </span>
                            </a>
                        </li>
                        <li>
                            <a href="category.html" class="waves-effect active">
                                <i class="fa fa-tags" aria-hidden="true"></i>
                                <span> 分类/标签 </span>
                            </a>
                        </li>
                        <li>
                            <a href="file.html" class="waves-effect">
                                <i class="fa fa-cloud-upload" aria-hidden="true"></i>
                                <span> 文件管理 </span>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <div class="content-page">
        <div class="content">
            <div class="container">
                <div class="row">
                    <div class="col-md-12">
                        <div>
                            <div>
                                <form id="cform" class="form-inline" role="form">
                                    <input type="hidden" id="mid"/>
                                    <div class="form-group">
                                        <input type="text" class="form-control" id="cname" placeholder="请输入分类名称"/>
                                    </div>
                                    <button id="save-category-btn" type="button"
                                            class="btn btn-sm btn-success" onclick="addCategory()">保存分类
                                    </button>
                                </form>
                            </div>
                            <table id="tb_category" class="table table-bordered">
                                <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>分类名称</th>
                                    <th>分类描述</th>
                                    <th>操作</th>
                                </tr>
                                </thead>
                                <tbody id="tb_tbody">
                                <tr>
                                    <td>
                                        1
                                    </td>
                                    <td>
                                        Java
                                    </td>
                                    <td>
                                        有关于Java知识的文章
                                    </td>
                                    <td>
                                        <button class="btn btn-danger" id="bt_delete_category">删除</button>
                                        <button class="btn btn-primary">编辑</button>
                                    </td>
                                </tr>
                                </tbody>

                            </table>

                            <nav class="pull-right">
                                <ul class="pagination" id="paging_toolbar">
                                    <li><a href="#" aria-label="Previous"><span aria-hidden="true">上一页</span></a></li>
                                    <li class="active"><a href="#">1<span class="sr-only">(current)</span></a></li>
                                    <li class=""><a href="#">2<span class="sr-only">(current)</span></a></li>
                                    <li class=""><a href="#">3<span class="sr-only">(current)</span></a></li>
                                    <li class=""><a href="#">4<span class="sr-only">(current)</span></a></li>
                                    <li class=""><a href="#">5<span class="sr-only">(current)</span></a></li>
                                    <li class="disabled"><a href="#" aria-label="Previous"><span
                                            aria-hidden="true">下一页</span></a></li>
                                </ul>
                            </nav>
                        </div>
                    </div>

                </div>

                <!--页脚-->
                <div>
                    <footer class="footer text-right">
                        2019 © <a href="#" target="_blank">我的博客</a>
                        <div class=""></div>
                    </footer>
                </div>
            </div>
        </div>
        <div class="modal fade" id="edit_modal" tabindex="-1" role="dialog">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h4 class="modal-title">编辑</h4>
                    </div>
                    <div class="modal-body form-horizontal">
                        <div class="form-group">
                            <label for="category_id" class="col-sm-2 control-label">ID</label>
                            <div class="col-sm-10">
                                <input type="email" class="form-control" id="category_id" disabled>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="category_name" class="col-sm-2 control-label">分类名称</label>
                            <div class="col-sm-10">
                                <input type="email" class="form-control" id="category_name" placeholder="分类名称">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="category_description" class="col-sm-2 control-label">分类描述</label>
                            <div class="col-sm-10">
                                <input type="text" class="form-control" id="category_description"
                                       placeholder="分类描述">
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                        <button type="button" class="btn btn-primary" onclick="updateCategory()">保存</button>
                    </div>
                </div>
            </div>
        </div>
    </div>


</div>

<!--所有页面必须导入start-->
<script src="../vendor/jquery/jquery.min.js"></script>
<script src="../vendor/bootstrap/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/limonte-sweetalert2/6.4.1/sweetalert2.min.js"></script>
<script src="../vendor/jquery.app.js"></script>
<script src="../vendor/base.js"></script>
<!--所有页面必须导入end-->


<script type="text/javascript">
    var tale = new $.tale();

    $(function () {
        //获取分类列表数据
        loadPage(1);
    });

    /**
     * 加载分页数据
     * @param currentPage 当前分页
     */
    function loadPage(currentPage) {
        $.get(getRootPath() + '/admin/category/listPage.action', "currentPage=" + currentPage, function (result) {
            if (result.code === 200) {
                //没有数据
                if (result.data == null) {
                    $("#tb_tbody").html("<tr><td class='text-center' colspan=\"4\">没有数据</td></tr>");
                    return;
                }
                var trTxt = "";
                for (var i = 0; i < result.data.list.length; i++) {
                    var category = result.data.list[i];
                    trTxt +=
                        "<tr>" +
                        "<td>" + category.id + "</td>" +
                        "<td>" + category.name + "</td>" +
                        "<td>" + category.description + "</td>" +
                        "<td><button class='btn btn-sm btn-danger' onclick='deleteCategory(" + category.id + ")' >删除</button>" +
                        "<button class='btn btn-sm btn-primary' onclick='showEditCategory(" + category.id + ")'>编辑</button></td>" +
                        "</tr>";
                }
                $("#tb_tbody").html(trTxt);

                //分页条
                var $paging_toolbar = $("#paging_toolbar");
                var paging_toolbarTxt = "<li class='disabled'><a href='#'>第" + result.data.currentPage + "页 / 共" + result.data.pageCount + "页</a></li>";

                //如果当前是第一页，那么【上一页】按钮不可点击
                if (currentPage === 1) {
                    paging_toolbarTxt += "<li class='disabled'><a href='#'>上一页</a></li>";
                } else {
                    paging_toolbarTxt += "<li onclick='loadPage(" + (currentPage - 1) + ")'><a href='#'>上一页</a></li>";
                }
                //遍历生成页码
                for (var i = result.data.pageBeginIndex; i <= result.data.pageEndIndex; i++) {
                    if (result.data.currentPage === i) {
                        paging_toolbarTxt += "<li onclick='loadPage(" + i + ")' class='active'><a href='#'>" + i + "</a></li>";
                    } else {
                        paging_toolbarTxt += "<li onclick='loadPage(" + i + ")' ><a href='#'>" + i + "</a></li>";
                    }
                }
                //如果当前是最后一页，那么【下一页】按钮不可点击
                if (currentPage === result.data.pageCount) {
                    paging_toolbarTxt += "<li class='disabled'><a href='#'>下一页</a></li>";
                } else {
                    paging_toolbarTxt += "<li onclick='loadPage(" + (currentPage + 1) + ")'><a href='#'>下一页</a></li>";
                }
                $paging_toolbar.html(paging_toolbarTxt);
            } else if (result.code === 403) {
                show403();
            }
        }, "json");
    }


    /**
     * 删除分类信息
     * @param cid 分类id
     */
    function deleteCategory(cid) {
        tale.alertConfirm({
            title: "确定删除" + cid + "吗?",
            then: function () {
                $.post(getRootPath() + '/admin/category/deleteById.action', {cid: cid}, function (result) {
                    if (result.code === 200) {
                        tale.alertOkAndReload('删除成功');
                    } else {
                        tale.alertError(result.msg || '删除失败');
                    }
                }, "json");
            }
        });
    }

    /**
     * 显示分类编辑框
     * @param cid 分类id
     */
    function showEditCategory(cid) {
        $.post(getRootPath() + "/admin/category/findById.action", "cid=" + cid, function (result) {
            if (result.code === 200) {
                $("#category_id").val(result.data.id);
                $("#category_name").val(result.data.name);
                $("#category_description").val(result.data.description);
                $('#edit_modal').modal("show");
            } else if (result.code === 403) {
                show403();
            }
        }, "json");
    }

    /**
     * 更新分类信息
     */
    function updateCategory() {
        var id = $("#category_id").val();
        var name = $("#category_name").val();
        var description = $("#category_description").val();
        $.post(getRootPath() + "/admin/category/updateCategoryById.action", "id=" + id + "&name=" + name + "&description=" + description, function (result) {
            if (result.code === 200) {
                $('#edit_modal').modal("hide");
                tale.alertOkAndReload('更新成功');
            } else if (result.code === 403) {
                show403();
            } else {
                tale.alertError(result.msg);
            }
        }, "json");
    }

    /**
     * 添加分类
     */
    function addCategory() {
        var cname = $('#cname').val();
        $.post('category/addCategory.action', {cname: cname}, function (result) {
            if (result.code === 200) {
                tale.alertOkAndReload('分类保存成功');
            } else if (result.code === 403) {
                show403();
            } else {
                tale.alertError(result.msg);
            }
        }, "json");
    }

</script>
</body>
</html>