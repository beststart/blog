<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <title>管理中心</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
    <meta content="Coderthemes" name="author"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <link rel="shortcut icon" href="../static/image/logo.png"/>
    <link href="../static/plugins/bootstrap/css/bootstrap.css" rel="stylesheet" type="text/css"/>
    <link href="../static/plugins/font-awesome-4.7.0/css/font-awesome.css" rel="stylesheet"/>
    <link href="../static/css/style.css" rel="stylesheet" type="text/css"/>
    <style>
        .overflow{
            overflow: hidden;
            white-space: nowrap;
            text-overflow: ellipsis;
        }
    </style>
</head>
<body>
<div id="wrapper">
    <!--头部和左边菜单-->
    <div>
        <div class="topbar">
            <div class="topbar-left">
                <div class="text-center p-t-10" style="margin: 0 auto;">
                    <div class="pull-left" style="padding-left: 10px;">
                        <a href="index.html">
                            <img src="../static/image/logo.png" width="50" height="50"/>
                        </a>
                    </div>
                    <div class="pull-left" style="padding-left: 10px;">
                        <span style="font-size: 20px; color: #2f353f; line-height: 50px;">我的博客</span>
                    </div>
                </div>
            </div>
            <div class="navbar navbar-default" role="navigation">
                <div class="container">
                    <div class="">
                        <div class="pull-left">
                            <button type="button" class="button-menu-mobile open-left">
                                <i class="fa fa-bars"></i>
                            </button>
                            <span class="clearfix"></span>
                        </div>

                        <ul class="nav navbar-nav navbar-right pull-right">
                            <li class="dropdown">
                                <a href="/admin/index.html" class="dropdown-toggle profile" data-toggle="dropdown"
                                   aria-expanded="true">
                                    <span class="glyphicon glyphicon-user"/>
                                </a>
                                <ul class="dropdown-menu">
                                    <li><a href="javascript:void(0);" onclick="logout()"><i class="fa fa-sign-out"></i>
                                        注销</a></li>
                                </ul>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <div class="left side-menu">
            <div class="sidebar-inner slimscrollleft">
                <div id="sidebar-menu">
                    <ul>
                        <li>
                            <a id="index" href="index.html" class="waves-effect active">
                                <i class="fa fa-dashboard" aria-hidden="true"></i>
                                <span> 仪表盘 </span>
                            </a>
                        </li>
                        <li>
                            <a id="article_edit" href="article_edit.html" class="waves-effect">
                                <i class="fa fa-pencil-square-o" aria-hidden="true"></i>
                                <span> 发布文章 </span>
                            </a>
                        </li>
                        <li>
                            <a href="article_list.html" class="waves-effect">
                                <i class="fa fa-list" aria-hidden="true"></i>
                                <span> 文章管理 </span>
                            </a>
                        </li>
                        <li>
                            <a href="comment_list.html" class="waves-effect">
                                <i class="fa fa-comments" aria-hidden="true"></i>
                                <span> 评论管理 </span>
                            </a>
                        </li>
                        <li>
                            <a href="category.html" class="waves-effect">
                                <i class="fa fa-tags" aria-hidden="true"></i>
                                <span> 分类/标签 </span>
                            </a>
                        </li>
                        <li>
                            <a href="file.html" class="waves-effect">
                                <i class="fa fa-cloud-upload" aria-hidden="true"></i>
                                <span> 文件管理 </span>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    <div class="content-page">
        <div class="content">
            <div class="container">
                <div class="row">
                    <div class="row">
                        <div class="col-sm-6 col-lg-4">
                            <div class="mini-stat clearfix bx-shadow bg-info">
                                <span class="mini-stat-icon"><i class="fa fa-quote-right" aria-hidden="true"></i></span>
                                <div class="mini-stat-info text-right">
                                    发表了<span class="counter" id="articleCount">10</span>篇文章
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-6 col-lg-4">
                            <div class="mini-stat clearfix bg-purple bx-shadow">
                                <span class="mini-stat-icon"><i class="fa fa-comments-o" aria-hidden="true"></i></span>
                                <div class="mini-stat-info text-right">
                                    收到了<span class="counter" id="commentCount">20</span>条留言
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-6 col-lg-4">
                            <div class="mini-stat clearfix bg-success bx-shadow">
                                <span class="mini-stat-icon"><i class="fa fa-cloud-upload"
                                                                aria-hidden="true"></i></span>
                                <div class="mini-stat-info text-right">
                                    上传了<span class="counter" id="attachesCount">50</span>个附件
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="panel panel-default">
                                <div class="panel-heading">
                                    <h4 class="panel-title">最新文章</h4>
                                </div>
                                <div class="panel-body">
                                    <ul class="list-group" id="new_article">
                                        <li class="list-group-item">
                                            <a target="_blank" href="#">我的学习之路</a>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="panel panel-default">
                                <div class="panel-heading">
                                    <h4 class="panel-title">最新评论</h4>
                                </div>
                                <div class="panel-body">
                                    <div id="not_comment" class="alert alert-warning">
                                            还没有收到评论.
                                    </div>
                                    <ul id="comment_ul" class="list-group">
                                        <li class="list-group-item">
                                            <div><a href="#" target="_blank">我是程序员</a></div>
                                            评论于：<span>2019年4月20日14:04:53</span><br/>
                                            <a href="#" target="_blank">好文章，支持！！！</a>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!--页脚-->
                <div>
                    <footer class="footer text-right">
                        2019 © <a href="#" target="_blank">Blog</a>
                        <div class=""></div>
                    </footer>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../static/plugins/jquery/jquery-3.4.0.js"></script>
<script src="../static/plugins/bootstrap/js/bootstrap.min.js"></script>
<script src="../static/plugins/jquery/jquery.app.js"></script>
<script src="../static/js/base.js"></script>
<script>
    $(function () {
        $.ajax({
            url:getRootPath()+'/admin/getIndexCount',
            method:'get',
            dataType:'json',
            success:function (res) {
                if(res.code==403){
                    show403();
                }else{
                    $('#articleCount').text(res.articleCount);
                    $('#commentCount').text(res.commentCount);
                    $('#attachesCount').text(res.imgCount);
                }
            },
            error:function (e) {
                alert('获取首页统计数量异常，请稍后再试...');
                console.log(e);
            }
        });

        $.ajax({
            url:getRootPath()+'/admin/getInfoList',
            method:'get',
            dataType:'json',
            success:function (res) {
                if(res.code==403){
                    show403();
                }else{
                    var articleList=res.articleList;
                    var commentList=res.commentList;
                    var articleHtml='';
                    if(articleList.length>0){
                        for(var i=0;i<articleList.length;i++){
                            articleHtml+='<li class="list-group-item" style="clear: left;height: 40px;">';
                            articleHtml+='<div class="overflow" style="width: 350px;float: left;"><a title="'+articleList[i].title+'" target="_blank" href="../post.html?aid='+articleList[i].id+'">'+articleList[i].title+'</a></div>';
                            articleHtml+='<div style="width:200px;float: right;">发表时间:'+articleList[i].created+'</div>';
                            articleHtml+='</li>';
                        }
                    }else{
                        articleHtml+='<li class="list-group-item"><a href="javascript:;">暂无文章</a></li>';
                    }
                    $('#new_article').empty().append(articleHtml);
                    var commentHtml='';
                    if(commentList.length>0){
                        $('#not_comment').remove();
                        for(var i=0;i<commentList.length;i++){
                            commentHtml+='<li class="list-group-item">';
                            commentHtml+='<div>评论人：'+commentList[i].name+'</div>';
                            var aname=commentList[i].aname;
                            if(aname.length>30){
                                aname=aname.substr(0,30)+'...';
                            }
                            commentHtml+='<div>评论文章：<a target="_blank" href="../post.html?aid='+commentList[i].aid+'" title="'+commentList[i].aname+'">'+aname+'</a></div>';
                            commentHtml+='<div>评论时间：<span>'+commentList[i].created+'</span></div>';
                            if(commentList[i].status==1){
                                commentHtml+='<div>状态：<span class="label label-default">未审核</span>👉<a href="comment_list.html"><span class="label label-default">审批</span></a></div>';
                            }else if(commentList[i].status==2){
                                commentHtml+='<div>状态：<span class="label label-success">通过</span>👉<a target="_blank" href="../post.html?aid='+commentList[i].aid+'#comment_list_'+commentList[i].id+'"><span class="label label-success">查看</span></a></div>';
                            }else{
                                commentHtml+='<div>状态：<span class="label label-warning">拒绝</span></div>';
                            }
                            var comment=commentList[i].content;
                            if(comment.length>50){
                                comment=comment.substr(0,50)+'...';
                            }
                            commentHtml+='<div title="'+commentList[i].content+'">内容：<br>'+comment+'</div>';
                            commentHtml+='</li>';
                        }
                    }else{
                        $('#comment_ul').remove();
                    }
                    $('#comment_ul').empty().append(commentHtml);
                }
            },
            error:function (e) {
                alert('获取首页最新文章和留言异常，请稍后再试...');
                console.log(e);
            }
        });
    });
</script>
</body>
</html>