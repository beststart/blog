<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8"/>
    <title>评论管理</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
    <meta content="Coderthemes" name="author"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <link rel="shortcut icon" href="../static/image/logo.png"/>
    <link href="../vendor/bootstrap/css/bootstrap.css" rel="stylesheet" type="text/css"/>
    <link href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet"/>
    <link href="../vendor/css/style.css" rel="stylesheet" type="text/css"/>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/limonte-sweetalert2/6.4.1/sweetalert2.min.css" rel="stylesheet"/>
    <link href="../vendor/tagsinput/jquery.tagsinput.css" rel="stylesheet"/>
    <link href="../vendor/select2.dist.css/select2-bootstrap.css" rel="stylesheet"/>
    <link href="../vendor/toggles/toggles.css" rel="stylesheet"/>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/multi-select/0.9.12/css/multi-select.min.css" rel="stylesheet"/>
    <link href="https://cdn.bootcss.com/select2/3.4.8/select2.min.css" rel="stylesheet">
    <style>
        #tags_addTag input {
            width: 100%;
        }
    </style>
</head>
<body class="fixed-left">
<div id="wrapper">
    <div>
        <div class="topbar">
            <div class="topbar-left">
                <div class="text-center p-t-10" style="margin: 0 auto;">
                    <div class="pull-left" style="padding-left: 10px;">
                        <a href="/admin/index.html">
                            <img src="../static/image/logo.png" width="50" height="50"/>
                        </a>
                    </div>
                    <div class="pull-left" style="padding-left: 10px;">
                        <span style="font-size: 20px; color: #2f353f; line-height: 50px;">我的博客</span>
                    </div>
                </div>
            </div>
            <div class="navbar navbar-default" role="navigation">
                <div class="container">
                    <div class="">
                        <div class="pull-left">
                            <button type="button" class="button-menu-mobile open-left">
                                <i class="fa fa-bars"></i>
                            </button>
                            <span class="clearfix"></span>
                        </div>

                        <ul class="nav navbar-nav navbar-right pull-right">
                            <li class="dropdown">
                                <a href="/admin/index.html" class="dropdown-toggle profile" data-toggle="dropdown"
                                   aria-expanded="true">
                                    <span class="glyphicon glyphicon-user"/>
                                </a>
                                <ul class="dropdown-menu">
                                    <li><a href="javascript:void(0);" onclick="logout()"><i class="fa fa-sign-out"></i>
                                        注销</a></li>
                                </ul>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <div class="left side-menu">
            <div class="sidebar-inner slimscrollleft">
                <div id="sidebar-menu">
                    <ul>
                        <li>
                            <a id="index" href="index.html" class="waves-effect">
                                <i class="fa fa-dashboard" aria-hidden="true"></i>
                                <span> 仪表盘 </span>
                            </a>
                        </li>
                        <li>
                            <a id="article_edit" href="article_edit.html?type=newArticle" class="waves-effect">
                                <i class="fa fa-pencil-square-o" aria-hidden="true"></i>
                                <span> 发布文章 </span>
                            </a>
                        </li>
                        <li>
                            <a href="article_list.html" class="waves-effect">
                                <i class="fa fa-list" aria-hidden="true"></i>
                                <span> 文章管理 </span>
                            </a>
                        </li>
                        <li>
                            <a href="comment_list.html" class="waves-effect active">
                                <i class="fa fa-comments" aria-hidden="true"></i>
                                <span> 评论管理 </span>
                            </a>
                        </li>
                        <li>
                            <a href="category.html" class="waves-effect">
                                <i class="fa fa-tags" aria-hidden="true"></i>
                                <span> 分类/标签 </span>
                            </a>
                        </li>
                        <li>
                            <a href="file.html" class="waves-effect">
                                <i class="fa fa-cloud-upload" aria-hidden="true"></i>
                                <span> 文件管理 </span>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <div class="content-page">
        <div class="content">
            <div class="container">
                <div class="row">
                    <div class="col-md-12">
                        <table class="table table-striped table-bordered">
                            <thead>
                            <tr>
                                <th>ID</th>
                                <th>评论人</th>
                                <th>评论内容</th>
                                <th>评论时间</th>
                                <th>IP</th>
                                <th>评论状态</th>
                                <th>操作</th>
                            </tr>
                            </thead>
                            <tbody id="tb_comment">
                            <tr>
                                <td>1</td>
                                <td>weidong</td>
                                <td>我是评论内容</td>
                                <td>2019年4月23日14:00:30</td>
                                <td>127.0.0.1</td>
                                <td>
                                    <span class="label label-success">审核通过</span>
                                    <span class="label label-default">未审核</span>
                                </td>
                                <td>
                                    <button class="btn btn-success btn-sm waves-effect waves-light">通过</button>
                                    <button class="btn btn-warning btn-sm waves-effect waves-light">拒绝</button>
                                    <button class="btn btn-danger btn-sm waves-effect waves-light">删除</button>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                        <nav class="pull-right">
                            <ul class="pagination" id="paging_toolbar">
                                <li><a href="#" aria-label="Previous"><span aria-hidden="true">上一页</span></a></li>
                                <li class="active"><a href="#">1<span class="sr-only">(current)</span></a></li>
                                <li class=""><a href="#">2<span class="sr-only">(current)</span></a></li>
                                <li class=""><a href="#">3<span class="sr-only">(current)</span></a></li>
                                <li class=""><a href="#">4<span class="sr-only">(current)</span></a></li>
                                <li class=""><a href="#">5<span class="sr-only">(current)</span></a></li>
                                <li class="disabled"><a href="#" aria-label="Previous"><span
                                        aria-hidden="true">下一页</span></a></li>
                            </ul>
                        </nav>
                    </div>
                </div>
                <!--页脚-->
                <div>
                    <footer class="footer text-right">
                        2019 © <a href="#" target="_blank">Blog</a>
                        <div class=""></div>
                    </footer>
                </div>
            </div>
        </div>
    </div>
</div>
<!--所有页面必须导入start-->
<script src="https://cdn.bootcss.com/jquery/2.2.3/jquery.min.js"></script>
<script src="../vendor/bootstrap/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/limonte-sweetalert2/6.4.1/sweetalert2.min.js"></script>
<script src="../vendor/jquery.app.js"></script>
<script src="../vendor/base.js"></script>
<!--所有页面必须导入end-->
<script type="text/javascript">
    var tale = new $.tale();

    $(function () {
        loadPage(1);
    });


    function loadPage(currentPage) {
        $.get("comment/getAllComment.action", "currentPage=" + currentPage, function (result) {
            if (result.code === 200) {
                //没有数据
                if (result.data == null) {
                    $("#tb_comment").html("<tr><td class='text-center' colspan=\"7\">没有数据</td></tr>");
                    return;
                }
                if (result.code === 200) {
                    //表格代码
                    var trTxt = "";
                    for (var i = 0; i < result.data.list.length; i++) {
                        var comment = result.data.list[i];
                        trTxt += "<tr>\n" +
                            "                                <td>" + comment.id + "</td>\n" +
                            "                                <td>" + comment.author + "</td>\n" +
                            "                                <td>" + comment.content + "</td>\n" +
                            "                                <td>" + new Date(comment.created).toLocaleString() + "</td>" +
                            "                                <td>" + comment.ip + "</td>";
                        if (comment.status === 0) {
                            trTxt += "<td><span class='label label-default'>未审核</span></td>";
                        } else if (comment.status === 1) {
                            trTxt += "<td><span class='label label-success'>审核通过</span></td>";
                        } else {
                            trTxt += "<td><span class='label label-danger'>拒绝</span></td>";
                        }
                        trTxt += "                                <td>" +
                            "                                    <button class='btn btn-success btn-sm waves-effect waves-light' onclick='updateStatus(" + comment.id + ",\"通过\",1," + currentPage + ")'>通过</button>\n" +
                            "                                    <button class=\"btn btn-warning btn-sm waves-effect waves-light\" onclick='updateStatus(" + comment.id + ",\"拒绝\",2," + currentPage + ")'>拒绝</button>\n" +
                            "                                    <button class=\"btn btn-danger btn-sm waves-effect waves-light\" onclick='deleteComment(" + comment.id + "," + currentPage + ")'>删除</button>\n" +
                            "                                </td>\n" +
                            "                            </tr>";
                    }
                    $("#tb_comment").html(trTxt);
                    //分页条
                    var $paging_toolbar = $("#paging_toolbar");
                    var paging_toolbarTxt = "<li class='disabled'><a href='#'>第" + result.data.currentPage + "页 / 共" + result.data.pageCount + "页</a></li>";

                    //如果当前是第一页，那么【上一页】按钮不可点击
                    if (currentPage === 1) {
                        paging_toolbarTxt += "<li class='disabled'><a href='#'>上一页</a></li>";
                    } else {
                        paging_toolbarTxt += "<li onclick='loadPage(" + (currentPage - 1) + ")'><a href='#'>上一页</a></li>";
                    }
                    //遍历生成页码
                    for (var i = result.data.pageBeginIndex; i <= result.data.pageEndIndex; i++) {
                        if (result.data.currentPage === i) {
                            paging_toolbarTxt += "<li onclick='loadPage(" + i + ")' class='active'><a href='#'>" + i + "</a></li>";
                        } else {
                            paging_toolbarTxt += "<li onclick='loadPage(" + i + ")' ><a href='#'>" + i + "</a></li>";
                        }
                    }
                    //如果当前是最后一页，那么【下一页】按钮不可点击
                    if (currentPage === result.data.pageCount) {
                        paging_toolbarTxt += "<li class='disabled'><a href='#'>下一页</a></li>";
                    } else {
                        paging_toolbarTxt += "<li onclick='loadPage(" + (currentPage + 1) + ")'><a href='#'>下一页</a></li>";
                    }
                    $paging_toolbar.html(paging_toolbarTxt);
                }

            } else if (result.code === 403) {
                show403();
            } else {
                tale.alertError(result.msg);
            }
        });
    }

    function deleteComment(cid, currentPage) {
        tale.alertConfirm({
            title: '确定删除该评论吗?',
            then: function () {
                $.post('comment/deleteById.action', "cid=" + cid, function (result) {
                    if (result.code === 200) {
                        //删除后直接刷新页面
                        loadPage(currentPage);
                    }else if (result.code === 403) {
                        show403();
                    } else {
                        tale.alertError(result.msg);
                    }
                });
            }
        });
    }
    function updateStatus(cid, msg, status, currentPage) {
        tale.alertConfirm({
            title: "确定" + msg + "该评论吗?",
            then: function () {
                $.post('comment/switchCommentStatus.action', "cid=" + cid + "&status=" + status, function (result) {
                    if (result.code === 200) {
                        //刷新页面
                        loadPage(currentPage);
                    } else if (result.code === 403) {
                        show403();
                    } else {
                        tale.alertError(result.msg);
                    }
                }, "json");
            }
        });
    }
</script>
</body>
</html>